import{j as e}from"./ui-vendor-Cdlq2rUE.js";import{a as t}from"./react-vendor-BDWLk7Fa.js";import{b as a,u as r,a as i,c,q as s,r as n}from"./index-BxVb7EoU.js";import{C as d}from"./redux-vendor-s_JgMA9B.js";import"./utils-vendor-D5b2lksY.js";const o={topic:[{id:"topic_none",text:"এখনো এই টাস্ক পারিনা",marks:-5},{id:"topic_understood",text:"শুধু বুঝেছি",marks:5},{id:"topic_learned_well",text:"ভালো করে শিখেছি",marks:10}]};function l(){const{user:l}=d(e=>e.auth),[x,m]=t.useState(""),[u,h]=t.useState(""),[p,b]=t.useState({}),[k,z]=t.useState(null),{data:g}=a(),{data:j}=r(),{data:f}=i({}),{data:v}=c(),[N]=s(),[S]=n(),w=g?.data||[],_=j?.data||[],C=f?.data||[],y=v?.data||[],q=w.find(e=>e._id===x),M=_.find(e=>e._id===u),E=C.filter(e=>e.group?._id===u||e.group===u);t.useEffect(()=>{if(x&&u){const e=y.find(e=>e.task?._id===x&&e.group?._id===u);if(e)z(e._id),b(e.scores||{});else{z(null);const e={};E.forEach(t=>{e[t._id]={taskScore:"",teamScore:"",mcqScore:"",additionalScore:0,totalScore:0,additionalCriteria:{topic:"",homework:!1,attendance:!1},comments:""}}),b(e)}}},[x,u,y]);const F=(e,t,a)=>{b(r=>{const i={...r[e]};if(t.startsWith("criteria.")){const e=t.split(".")[1];i.additionalCriteria={...i.additionalCriteria,[e]:a}}else i[t]=a;const c=parseFloat(i.taskScore)||0,s=parseFloat(i.teamScore)||0,n=parseFloat(i.mcqScore)||0;let d=0;const l=o.topic.find(e=>e.id===i.additionalCriteria.topic);l&&(d+=l.marks),i.additionalCriteria.homework&&(d+=5),i.additionalCriteria.attendance&&(d+=10);const x=q?.maxScoreBreakdown?.additional||25;d=Math.min(Math.max(d,-5),x),i.additionalScore=d;const m=c+s+n+d,u=q?.maxScore||100;return i.totalScore=Math.min(Math.max(m,0),u),{...r,[e]:i}})},B=q?.maxScoreBreakdown||{task:20,team:15,additional:25,mcq:40};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-zinc-900 dark:text-white",children:"মূল্যায়ন"}),e.jsx("p",{className:"text-sm md:text-base text-zinc-500 dark:text-zinc-400",children:"শিক্ষার্থী এবং গ্রুপের পারফরম্যান্স মূল্যায়ন করুন"})]}),e.jsxs("div",{className:"card card-body bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-zinc-700 dark:text-zinc-300",children:"টাস্ক নির্বাচন করুন"}),e.jsxs("select",{value:x,onChange:e=>m(e.target.value),className:"form-input bg-white dark:bg-zinc-800 border-zinc-300 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100",children:[e.jsx("option",{value:"",children:"নির্বাচন করুন..."}),w.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-zinc-700 dark:text-zinc-300",children:"গ্রুপ নির্বাচন করুন"}),e.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"form-input bg-white dark:bg-zinc-800 border-zinc-300 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100",children:[e.jsx("option",{value:"",children:"নির্বাচন করুন..."}),_.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]})]}),x&&u&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!q||!M)return;const t=Object.values(p).filter(e=>""!==e.taskScore||""!==e.teamScore||""!==e.mcqScore||e.additionalCriteria.topic);if(0===t.length)return void alert("Please score at least one student.");const a=t.reduce((e,t)=>e+t.totalScore,0),r=a/t.length/(q.maxScore||100)*100,i={task:x,group:u,scores:p,studentCount:t.length,groupTotalScore:a,groupAverageScore:r,maxPossibleScore:q.maxScore||100};try{k?(await S({id:k,...i}).unwrap(),alert("Evaluation updated successfully!")):(await N(i).unwrap(),alert("Evaluation submitted successfully!"))}catch(c){alert(c.data?.message||"Operation failed")}},children:[e.jsx("div",{className:"overflow-x-auto rounded-xl border border-zinc-200 dark:border-zinc-800",children:e.jsxs("table",{className:"w-full text-sm text-left text-zinc-500 dark:text-zinc-400",children:[e.jsx("thead",{className:"text-xs text-zinc-700 uppercase bg-zinc-100 dark:bg-zinc-800 dark:text-zinc-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"রোল"}),e.jsx("th",{className:"p-3",children:"নাম"}),e.jsxs("th",{className:"p-3 text-center",children:["টাস্ক (",B.task,")"]}),e.jsxs("th",{className:"p-3 text-center",children:["টিম (",B.team,")"]}),e.jsxs("th",{className:"p-3 text-center",children:["MCQ (",B.mcq,")"]}),e.jsxs("th",{className:"p-3 text-center w-1/3",children:["অতিরিক্ত (",B.additional,")"]}),e.jsxs("th",{className:"p-3 text-center",children:["মোট (",q.maxScore,")"]})]})}),e.jsx("tbody",{className:"bg-white dark:bg-zinc-900 divide-y divide-zinc-200 dark:divide-zinc-800",children:E.map(t=>{const a=p[t._id]||{taskScore:"",teamScore:"",mcqScore:"",additionalCriteria:{topic:"",homework:!1,attendance:!1},totalScore:0};return e.jsxs("tr",{className:"hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e.jsx("td",{className:"p-3 font-medium text-zinc-900 dark:text-zinc-50",children:t.roll}),e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-zinc-50",children:t.name}),e.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:t.role})]}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",className:"form-input w-20 text-center mx-auto bg-white dark:bg-zinc-800 border-zinc-300 dark:border-zinc-700 text-zinc-900 dark:text-zinc-50 focus:ring-blue-500 dark:focus:ring-blue-400",value:a.taskScore,onChange:e=>F(t._id,"taskScore",e.target.value),max:B.task})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",className:"form-input w-20 text-center mx-auto bg-white dark:bg-zinc-800 border-zinc-300 dark:border-zinc-700 text-zinc-900 dark:text-zinc-50 focus:ring-blue-500 dark:focus:ring-blue-400",value:a.teamScore,onChange:e=>F(t._id,"teamScore",e.target.value),max:B.team})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",className:"form-input w-20 text-center mx-auto bg-white dark:bg-zinc-800 border-zinc-300 dark:border-zinc-700 text-zinc-900 dark:text-zinc-50 focus:ring-blue-500 dark:focus:ring-blue-400",value:a.mcqScore,onChange:e=>F(t._id,"mcqScore",e.target.value),max:B.mcq})}),e.jsx("td",{className:"p-3 bg-zinc-50 dark:bg-zinc-900/30",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:o.topic.map(r=>e.jsxs("label",{className:"flex items-center space-x-1 text-xs cursor-pointer text-zinc-700 dark:text-zinc-300 hover:text-blue-600 dark:hover:text-blue-400",children:[e.jsx("input",{type:"radio",name:`topic-${t._id}`,checked:a.additionalCriteria?.topic===r.id,onChange:()=>F(t._id,"criteria.topic",r.id),className:"text-blue-600 focus:ring-blue-500 dark:bg-zinc-800 dark:border-zinc-700"}),e.jsxs("span",{children:[r.text," (",r.marks,")"]})]},r.id))}),e.jsxs("div",{className:"flex gap-3 border-t pt-1 border-zinc-200 dark:border-zinc-700",children:[e.jsxs("label",{className:"flex items-center space-x-1 text-xs cursor-pointer text-zinc-700 dark:text-zinc-300 hover:text-blue-600 dark:hover:text-blue-400",children:[e.jsx("input",{type:"checkbox",checked:a.additionalCriteria?.homework,onChange:e=>F(t._id,"criteria.homework",e.target.checked),className:"rounded text-blue-600 focus:ring-blue-500 dark:bg-zinc-800 dark:border-zinc-700"}),e.jsx("span",{children:"বাড়ির কাজ (+5)"})]}),e.jsxs("label",{className:"flex items-center space-x-1 text-xs cursor-pointer text-zinc-700 dark:text-zinc-300 hover:text-blue-600 dark:hover:text-blue-400",children:[e.jsx("input",{type:"checkbox",checked:a.additionalCriteria?.attendance,onChange:e=>F(t._id,"criteria.attendance",e.target.checked),className:"rounded text-blue-600 focus:ring-blue-500 dark:bg-zinc-800 dark:border-zinc-700"}),e.jsx("span",{children:"উপস্থিতি (+10)"})]})]})]})}),e.jsx("td",{className:"p-3 text-center font-bold text-lg text-zinc-900 dark:text-zinc-50",children:a.totalScore})]},t._id)})})]})}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{type:"submit",className:"btn btn-primary px-8",children:k?"আপডেট করুন":"জমা দিন"})})]})]})]})}export{l as default};
