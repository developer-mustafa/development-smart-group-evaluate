import{j as e}from"./ui-vendor-Cdlq2rUE.js";import{a as t}from"./react-vendor-BDWLk7Fa.js";import{a as r,c as a,b as s,u as n}from"./index-BxVb7EoU.js";import{S as o}from"./StudentDetailModal-reJEotCq.js";import{G as i}from"./GroupDetailModal-BlI9tid9.js";import"./redux-vendor-s_JgMA9B.js";import"./utils-vendor-D5b2lksY.js";import"./table-CmieK8SB.js";const c=e=>{const t={0:"০",1:"১",2:"২",3:"৩",4:"৪",5:"৫",6:"৬",7:"৭",8:"৮",9:"৯"};return e.toString().replace(/[0-9]/g,e=>t[e])},d=e=>{const t={1:"১ম",2:"২য়",3:"৩য়",4:"৪র্থ",5:"৫ম",6:"৬ষ্ঠ",7:"৭ম",8:"৮ম",9:"৯ম",10:"১০ম"};return t[e]?t[e]+" র‍্যাঙ্ক":c(e)+"তম র‍্যাঙ্ক"},l=e=>{const t=Number(e)||0;return t>=85?{solid:"#16a34a",shadow:"rgba(22,163,74,.35)",grad:"linear-gradient(90deg,#16a34a 0%,#22c55e 40%,#86efac 100%)"}:t>=70?{solid:"#0284c7",shadow:"rgba(2,132,199,.30)",grad:"linear-gradient(90deg,#0284c7 0%,#0ea5e9 40%,#7dd3fc 100%)"}:t>=55?{solid:"#d97706",shadow:"rgba(217,119,6,.35)",grad:"linear-gradient(90deg,#d97706 0%,#f59e0b 40%,#facc15 100%)"}:{solid:"#e11d48",shadow:"rgba(225,29,72,.40)",grad:"linear-gradient(90deg,#e11d48 0%,#f43f5e 40%,#fb7185 100%)"}},x=e=>({"team-leader":"টিম লিডার","time-keeper":"টাইম কিপার",reporter:"রিপোর্টার","resource-manager":"রিসোর্স ম্যানেজার","peace-maker":"পিস মেকার"}[e]||e||"দায়িত্ব নেই"),m=({percent:t,palette:r,size:a=72})=>{const s=Math.max(0,Math.min(100,Number(t)||0)),n="conic-gradient("+r.solid+" "+s+"%, rgba(0,0,0,0.08) "+s+"% 100%)",o="drop-shadow(0 6px 16px "+r.shadow+")";return e.jsxs("div",{className:"relative flex items-center justify-center",style:{width:a,height:a},children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:n,filter:o}}),e.jsx("div",{className:"absolute inset-[18%] rounded-full bg-card flex items-center justify-center shadow-inner",children:e.jsxs("span",{className:"text-sm font-semibold text-zinc-800 dark:text-zinc-100",children:[c(s.toFixed(2)),"%"]})})]})},u=({meta:t,label:r})=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg border text-[11px] font-semibold shadow-sm "+t.bg+" "+t.text+" "+t.border+" dark:bg-opacity-20 dark:border-opacity-30",children:[e.jsx("i",{className:"fas "+t.icon+" text-[10px]"}),r]});function p(){const[p,b]=t.useState("students"),[g,f]=t.useState(""),[h,j]=t.useState(""),[v,z]=t.useState(null),[k,y]=t.useState(null),{data:w}=r(),{data:N}=a(),{data:S}=s(),{data:M}=n(),C=t.useMemo(()=>w?.data||[],[w]),F=t.useMemo(()=>N?.data||[],[N]);t.useMemo(()=>S?.data||[],[S]);const _=t.useMemo(()=>M?.data||[],[M]),E=t.useMemo(()=>{if(!C.length||!F.length)return[];const e={};return F.forEach(t=>{const r=parseFloat(t.maxPossibleScore)||100,a=t.scores||{},s=new Date(t.createdAt).getTime();Object.entries(a).forEach(([t,a])=>{e[t]||(e[t]={evalCount:0,totalScore:0,maxScoreSum:0,latestMs:0});const n=parseFloat(a.totalScore)||0,o=e[t];o.evalCount+=1,o.totalScore+=n,o.maxScoreSum+=r,o.latestMs=Math.max(o.latestMs,s)})}),C.map(t=>{const r=e[t._id];if(!r||r.evalCount<1)return null;const a=r.maxScoreSum>0?r.totalScore/r.maxScoreSum*100:0;return{...t,...r,efficiency:a}}).filter(Boolean).sort((e,t)=>t.efficiency!==e.efficiency?t.efficiency-e.efficiency:t.evalCount!==e.evalCount?t.evalCount-e.evalCount:t.totalScore!==e.totalScore?t.totalScore-e.totalScore:t.latestMs-e.latestMs).map((e,t)=>({...e,rank:t+1}))},[C,F]),A=t.useMemo(()=>{if(!_.length||!F.length)return[];const e={},t={};return C.forEach(e=>{const r=e.group?._id||e.group;r&&(t[r]=(t[r]||0)+1)}),F.forEach(t=>{const r=parseFloat(t.maxPossibleScore)||100,a=new Date(t.createdAt).getTime(),s=t.scores||{},n="object"==typeof t.group?t.group?._id:t.group;if(!n)return;e[n]||(e[n]={evalCount:0,totalScore:0,maxScoreSum:0,latestMs:0,participants:new Set});const o=e[n];o.evalCount+=1,o.latestMs=Math.max(o.latestMs,a),Object.entries(s).forEach(([e,t])=>{o.totalScore+=parseFloat(t.totalScore)||0,o.maxScoreSum+=r,o.participants.add(e)})}),_.map(r=>{const a=e[r._id];if(!a)return null;const s=a.maxScoreSum>0?a.totalScore/a.maxScoreSum*100:0,n=t[r._id]||0,o=a.participants.size;return{...r,...a,efficiency:s,totalMembers:n,uniqueParticipants:o,remainingMembers:Math.max(0,n-o)}}).filter(Boolean).sort((e,t)=>t.efficiency-e.efficiency).map((e,t)=>({...e,rank:t+1}))},[_,F,C]),D=t.useMemo(()=>E.filter(e=>{const t=e.name.toLowerCase().includes(g.toLowerCase()),r=!h||e.roll.toString().includes(h);return t&&r}),[E,g,h]),G="students"===p?E[0]:A[0],P=l(G?G.efficiency:70);return e.jsxs("div",{className:"min-h-screen bg-background p-4 md:p-8 font-sans transition-colors duration-300",children:[e.jsx("div",{className:"max-w-5xl mx-auto mb-6",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-zinc-900 dark:text-zinc-50",children:"র‍্যাঙ্কিং লিডারবোর্ড"}),e.jsx("p",{className:"text-sm md:text-base text-zinc-500 dark:text-zinc-400",children:"শীর্ষ পারফরমার এবং গ্রুপগুলোর তালিকা"})]})}),e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"rounded-2xl p-3 bg-card shadow-sm border border-border flex flex-col md:flex-row gap-4 items-center justify-between transition-all duration-300",children:[e.jsxs("div",{className:"flex p-1 bg-muted rounded-full border border-border",children:[e.jsx("button",{onClick:()=>b("students"),className:"px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 "+("students"===p?"text-white shadow-md transform scale-105":"text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700"),style:"students"===p?{background:P.grad}:{},children:"শিক্ষার্থী র‍্যাঙ্কিং"}),e.jsx("button",{onClick:()=>b("groups"),className:"px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 "+("groups"===p?"text-white shadow-md transform scale-105":"text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700"),style:"groups"===p?{background:P.grad}:{},children:"গ্রুপ র‍্যাঙ্কিং"})]}),e.jsxs("div",{className:"flex gap-3 w-full md:w-auto transition-opacity duration-300 "+("students"===p?"opacity-100":"opacity-50 pointer-events-none"),children:[e.jsx("input",{type:"text",placeholder:"নাম দিয়ে সার্চ",value:g,onChange:e=>f(e.target.value),disabled:"students"!==p,className:"px-4 py-2 rounded-xl bg-background border border-border focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 w-full md:w-48 text-sm text-foreground placeholder-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"রোল",value:h,onChange:e=>j(e.target.value),disabled:"students"!==p,className:"px-4 py-2 rounded-xl bg-zinc-50 dark:bg-zinc-950 border border-border focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 w-full md:w-32 text-sm text-zinc-900 dark:text-zinc-50 placeholder-zinc-400 dark:placeholder-zinc-500"})]})]}),e.jsx("div",{className:"grid gap-4",children:"students"===p?D.length>0?D.map(t=>{const r=l(t.efficiency),a={"team-leader":{icon:"fa-crown",bg:"bg-amber-100",text:"text-amber-800",border:"border-amber-200"},"time-keeper":{icon:"fa-stopwatch",bg:"bg-sky-100",text:"text-sky-800",border:"border-sky-200"},reporter:{icon:"fa-pen-nib",bg:"bg-purple-100",text:"text-purple-800",border:"border-purple-200"},"resource-manager":{icon:"fa-box-open",bg:"bg-emerald-100",text:"text-emerald-800",border:"border-emerald-200"},"peace-maker":{icon:"fa-dove",bg:"bg-rose-100",text:"text-rose-800",border:"border-rose-200"}}[(t.role||"").toString().trim()]||{icon:"fa-id-badge",bg:"bg-zinc-100",text:"text-zinc-800",border:"border-zinc-200"};const s=(e=>{const t=(e||"").toString().trim().toLowerCase();return/science|বিজ্ঞান/.test(t)?{icon:"fa-atom",bg:"bg-teal-100",text:"text-teal-800",border:"border-teal-200"}:/arts|মানবিক/.test(t)?{icon:"fa-palette",bg:"bg-orange-100",text:"text-orange-800",border:"border-orange-200"}:/commerce|ব্যবসা|কমার্স/.test(t)?{icon:"fa-chart-line",bg:"bg-indigo-100",text:"text-indigo-800",border:"border-indigo-200"}:/vocational|ভোকেশনাল/.test(t)?{icon:"fa-tools",bg:"bg-cyan-100",text:"text-cyan-800",border:"border-cyan-200"}:{icon:"fa-layer-group",bg:"bg-zinc-100",text:"text-zinc-800",border:"border-zinc-200"}})(t.academicGroup);return e.jsxs("div",{onClick:()=>z(t),className:"group relative bg-card rounded-2xl p-4 md:p-5 flex items-center justify-between gap-4 shadow-sm hover:shadow-md transition-all duration-300 border border-border overflow-hidden cursor-pointer",children:[e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-5 dark:group-hover:opacity-10 transition-opacity duration-500 pointer-events-none",style:{background:r.grad}}),e.jsxs("div",{className:"flex items-center gap-4 md:gap-6 min-w-0 z-10",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center w-16 h-14 bg-muted rounded-xl border border-border shadow-sm shrink-0",children:[e.jsx("span",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-50",children:d(t.rank).split(" ")[0]}),e.jsx("span",{className:"text-[10px] text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"র‍্যাঙ্ক"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-50 truncate mb-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:t.name}),e.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mb-2 truncate",children:["রোল: ",c(t.roll)," · গ্রুপ: ",t.group?.name||"গ্রুপ নেই"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(u,{meta:s,label:t.academicGroup||"শাখা নেই"}),e.jsx(u,{meta:a,label:x(t.role)})]}),e.jsxs("div",{className:"flex gap-6 mt-3 text-xs font-semibold text-zinc-600 dark:text-zinc-300",children:[e.jsxs("span",{className:"hidden sm:inline",children:["গড়: ",c(t.efficiency.toFixed(2)),"%"]}),e.jsxs("span",{children:["এসাইনমেন্ট: ",c(t.evalCount)," টি"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 shrink-0 z-10",children:[e.jsx(m,{percent:t.efficiency,palette:r,size:72}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 dark:text-zinc-500 uppercase tracking-wider",children:"Avg%"})]})]},t._id)}):e.jsx("div",{className:"text-center py-12 text-zinc-500 dark:text-zinc-400",children:"কোনো শিক্ষার্থী পাওয়া যায়নি"}):A.length>0?A.map(t=>{const r=l(t.efficiency);return e.jsxs("div",{onClick:()=>y(t),className:"group relative bg-card rounded-2xl p-4 md:p-5 flex items-center justify-between gap-4 shadow-sm hover:shadow-md transition-all duration-300 border border-border overflow-hidden cursor-pointer",children:[e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-5 dark:group-hover:opacity-10 transition-opacity duration-500 pointer-events-none",style:{background:r.grad}}),e.jsxs("div",{className:"flex items-center gap-4 md:gap-6 min-w-0 z-10",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center w-16 h-14 bg-zinc-50 dark:bg-zinc-800/50 rounded-xl border border-zinc-100 dark:border-zinc-700 shadow-sm shrink-0",children:[e.jsx("span",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-50",children:d(t.rank).split(" ")[0]}),e.jsx("span",{className:"text-[10px] text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"র‍্যাঙ্ক"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-50 truncate mb-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:t.name}),e.jsxs("div",{className:"flex gap-2 mt-1 mb-2",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-md bg-zinc-100 dark:bg-zinc-800 text-xs font-medium text-zinc-600 dark:text-zinc-300",children:["গড়: ",c(t.efficiency.toFixed(2)),"%"]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-md bg-zinc-100 dark:bg-zinc-800 text-xs font-medium text-zinc-600 dark:text-zinc-300",children:["অংশগ্রহণ: ",c(t.evalCount)]})]}),e.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:["মোট সদস্য: ",c(t.totalMembers)," · পরীক্ষায় অংশগ্রহণ: ",c(t.uniqueParticipants)," · বাকি: ",c(t.remainingMembers)]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 shrink-0 z-10",children:[e.jsx(m,{percent:t.efficiency,palette:r,size:72}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 dark:text-zinc-500 uppercase tracking-wider",children:"Avg%"})]})]},t._id)}):e.jsx("div",{className:"text-center py-12 text-zinc-500 dark:text-zinc-400",children:"কোনো গ্রুপ ডেটা পাওয়া যায়নি"})})]}),v&&e.jsx(o,{student:v,onClose:()=>z(null)}),k&&e.jsx(i,{group:k,onClose:()=>y(null)})]})}export{p as default};
